@inject ISnackbar _Snackbar
@rendermode InteractiveAuto
@inject HttpClient Http



<MudDialog Class="custom-modal" Style="width: 100vw; height: auto">
    <DialogContent>
        <EditForm Model="@CompanyInfo" OnValidSubmit="Submit" Class="custom-form">
            <DataAnnotationsValidator />

            <MudTextField For="@(()=>CompanyInfo.Name)" Label="اسم الشركه" Immediate="false" @bind-Value="@CompanyInfo.Name" Adornment="Adornment.End" AdornmentIcon="@((BtnName == "اضافه") ? Icons.Material.Filled.Add : Icons.Material.Filled.Edit)" AdornmentColor="Color.Success"></MudTextField>

            <MudTextField For="@(()=>CompanyInfo.Mobile)" Label="رقم الجوال" Immediate="false" @bind-Value="@CompanyInfo.Mobile" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Add" AdornmentColor="Color.Success"></MudTextField>
            <MudTextField For="@(()=>CompanyInfo.LicenseNumber)" Label="رقم الرخصه" Immediate="false" @bind-Value="@CompanyInfo.LicenseNumber" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Add" AdornmentColor="Color.Success"></MudTextField>
            <MudTextField For="@(()=>CompanyInfo.Telephone)" Label="رقم الهاتف" Immediate="false" @bind-Value="@CompanyInfo.Telephone" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Add" AdornmentColor="Color.Success"></MudTextField>
            <MudTextField For="@(()=>CompanyInfo.Email)" Label="الجيميل" Immediate="false" @bind-Value="@CompanyInfo.Email" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Add" AdornmentColor="Color.Success"></MudTextField>
            <MudTextField For="@(()=>CompanyInfo.Web)" Label="موقع الويب" Immediate="false" @bind-Value="@CompanyInfo.Web" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Add" AdornmentColor="Color.Success"></MudTextField>
            <MudTextField For="@(()=>CompanyInfo.IVT)" Label="IvT" Immediate="false" @bind-Value="@CompanyInfo.IVT" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Add" AdornmentColor="Color.Success"></MudTextField>

            <br />

            <MudButton OnClick="Cancel" Class="custom-button">الغاء</MudButton>
            <MudButton Color="Color.Primary" ButtonType="ButtonType.Submit" Class="custom-button">@BtnName</MudButton>
            
            <br />
             </EditForm>
    </DialogContent>
  
</MudDialog>




    @code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    [Parameter]
    public EventCallback<bool> OnClose { get; set; }

    [Parameter]
    public CompanyInfo OriginalCompanyInfo { get; set; }  // تم تغيير النوع إلى CompanyInfo

    [Parameter]
    public string BtnName { get; set; }

    string Icon = string.Empty;

    public CompanyInfo CompanyInfo { get; set; }

    protected override void OnParametersSet()
    {
        if (OriginalCompanyInfo == null)
        {
            CompanyInfo = new CompanyInfo();
        }
        else
        {
   
            CompanyInfo = new CompanyInfo
                {
                    Id = OriginalCompanyInfo.Id,
                    Name = OriginalCompanyInfo.Name,
                    Mobile=OriginalCompanyInfo.Mobile,
                    LicenseNumber=OriginalCompanyInfo.LicenseNumber,
                    Telephone = OriginalCompanyInfo.Telephone,
                    Email = OriginalCompanyInfo.Email,
                    Web = OriginalCompanyInfo.Web,
                    IVT = OriginalCompanyInfo.IVT,
                    
                };
        }
    }

    async void Submit()
    {
        if (!string.IsNullOrWhiteSpace(CompanyInfo.Name))
        {
            if (CompanyInfo.Id == 0)
            {
                // The CompanyInfo has no ID, so it's a new CompanyInfo
                await Http.PostAsJsonAsync("api/CompanyInfos/AddOneAsync", CompanyInfo);
                // Show a success message
                _Snackbar.Add("CompanyInfo added successfully!", Severity.Success);
            }
            else
            {
                await Http.PutAsJsonAsync("api/CompanyInfos", CompanyInfo);
                _Snackbar.Add("CompanyInfo updated successfully!", Severity.Success);
            }

            MudDialog.Close(DialogResult.Ok(true));
            // Trigger the OnClose event
            OnClose.InvokeAsync(true);
        }
    }

    void Cancel() => MudDialog.Cancel();
}





