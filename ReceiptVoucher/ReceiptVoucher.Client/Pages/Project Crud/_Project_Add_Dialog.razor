@inject ISnackbar _Snackbar
@rendermode InteractiveAuto
@inject HttpClient Http


<MudDialog Class="custom-modal" Style="width: 100vw; height: auto">
    <DialogContent>
        <EditForm Model="@Project" OnValidSubmit="Submit" Class="custom-form">
            <DataAnnotationsValidator />

            <MudTextField Immediate="true" For="@(()=>Project.Name)" @bind-Value="@Project.Name" Adornment="Adornment.End"  AdornmentColor="Color.Success"></MudTextField>


            <br />
            <MudTextField T="string" Label="ملاحظة" Variant="Variant.Text" For="@(()=>Project.Note)" @bind-Value="@Project.Note" Lines="3" />


            <br />
            <MudCheckBox Label="حاله التفعيل" @bind-Value="@Project.IsActive" Dense="true" Color="Color.Success"></MudCheckBox>

            <br />

            @if (BtnName != ButtonTypes.Details)
            {
                <MudButton OnClick="Cancel" Class="custom-button">الغاء</MudButton>
                <MudButton Color="Color.Primary" ButtonType="ButtonType.Submit" Class="custom-button">@BtnName</MudButton>
            }


            
             </EditForm>
    </DialogContent>
 
</MudDialog>




    @code {

    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    [Parameter]
    public EventCallback<bool> OnClose {get; set; }

    [Parameter]
    public Project OriginalProject { get; set; }


    [Parameter]
    public string BtnName { get; set; }

 


  public Project Project {get; set; }

  

    protected override void OnParametersSet()
    {
        if (OriginalProject == null)
        {
            Project = new Project();

        }
        else
        {

            Project = new Project
            {
                    Id = OriginalProject.Id,
                    Name = OriginalProject.Name,
                    Note = OriginalProject.Note,
                    IsActive = OriginalProject.IsActive
                
            };


        }
    }

    async void Submit()
    {
        if (!string.IsNullOrWhiteSpace(Project.Name))
        {
            if (Project.Id == 0)
            {
                // The branch has no ID, so it's a new branch

             


                var response = await Http.PostAsJsonAsync("https://localhost:7210/api/Projects/AddOneAsync", Project);
                if (response.IsSuccessStatusCode)
                {
                    _Snackbar.Add("Project add successfully!", Severity.Success);
                }
                else
                {
                    _Snackbar.Add($"Failed to add project. Error: {response.StatusCode}", Severity.Error);
                }

               
            }

            else
            {

                var response = await Http.PutAsJsonAsync("https://localhost:7210/api/Projects", Project);
                if (response.IsSuccessStatusCode)
                {
                    _Snackbar.Add("project updated successfully!", Severity.Success);
                }
                else
                {
                    _Snackbar.Add($"Failed to update project. Error: {response.StatusCode}", Severity.Error);
                }

            }

            MudDialog.Close(DialogResult.Ok(true));

            // Trigger the OnClose event
            OnClose.InvokeAsync(true);
        }
    }


    void Cancel() => MudDialog.Cancel();

    
}




