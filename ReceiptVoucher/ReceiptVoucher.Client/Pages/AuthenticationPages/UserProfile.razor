
@rendermode @(new InteractiveServerRenderMode(false) )

@* @rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false) ) *@


@page "/UserProfile"
@using ReceiptVoucher.Core.Models.Dtos.Auth
@using System.Security.Claims
@attribute [Authorize]

@inject ReceiptVoucher.Client.Services.IAuthService _IAuthService
@inject AuthenticationStateProvider _AuthenticationStateProvider


<p style=" margin-bottom:2% ;">


    <b style="color:dodgerblue;font-size:xx-large">|</b>
    <span class="mainTitle">

        <MudIcon Icon="@Icons.Material.Filled.FileCopy" Size="Size.Large" Style="color:#566D7E ;margin-bottom:2px" />

        الصفحة الشخصية



    </span>

</p>



<div class="profileContainer">
    <img src="Images\avatar.webp" alt="Avatar"/>
    <MudGrid>
        <MudItem xs="12" sm="6">
            <h4 class="">الاسم: <span>مرعي علي بن هلابي</span></h4>
        </MudItem>
        <MudItem xs="12" sm="6">
            <h4 class="">الفرع: <span>الرياض</span></h4>
        </MudItem>
        <MudItem xs="12" sm="6">
            <h4 class="">رقم الجوال: <span>0558678049</span></h4>
        </MudItem>
        <MudItem xs="12" sm="6">
            <h4 class="">نوع الحساب: <span>مستخدم</span></h4>
        </MudItem>
        <MudItem xs="12" Class="text-center">
            <h4 class="">البريد الإلكتروني: <span>mrai.hlabi@gmail.com</span></h4>
        </MudItem>
        <MudItem xs="12">
            <MudButton Class="custom-btn mx-auto" Variant="Variant.Filled" Color="Color.Primary">
                <MudIcon Icon="@Icons.Material.Filled.VpnKey" Title="add" />
                <span>تغيير كلمة المرور</span>
            </MudButton>
        </MudItem>
    </MudGrid>
</div>

<AuthorizeView>
@*     <h3>Hi You Logged with  <i>@context.User.Identity.Name</i> .</h3>
    <h3>Hi   <i>@userName</i> .</h3> *@
</AuthorizeView>



<div class="continerPass">
    <h5>تغيير كلمة المرور</h5>
    <EditForm Model="request" OnValidSubmit="ChangePassword">
        <DataAnnotationsValidator></DataAnnotationsValidator>
        <MudGrid>
            <MudItem xs="12" >
            <label for="currentPassword">كلمة المرور الحالية</label>
            <InputText id="currentPassword" @bind-Value="request.CurrentPassword" class="form-control" type="password" />
            <ValidationMessage For="@(() => request.CurrentPassword)" />
        </MudItem>
            <MudItem xs="12" sm="6">
            <label for="newPassword">كلمة المرور الجديدة</label>
            <InputText id="newPassword" @bind-Value="request.NewPassword" class="form-control" type="password" />
            <ValidationMessage For="@(() => request.NewPassword)" />
        </MudItem>
        <MudItem xs="12" sm="6">
            <label for="confirmPassword">تأكيد كلمة المرور </label>
            <InputText id="confirmPassword" @bind-Value="request.ConfirmPassword" class="form-control" type="password" />
            <ValidationMessage For="@(() => request.ConfirmPassword)" />
        </MudItem>
            <MudItem xs="12">
        <button type="submit" class="btn btn-primary">تغيير كلمة المرور</button>
        </MudItem>
        </MudGrid>
    </EditForm>
    <p>@message</p>
</div>


@code {
    UserChangePassword request = new();

    string message = string.Empty;

    private string userName;


    private async Task ChangePassword()
    {
        var result = await _IAuthService.ChangePassword(request);
        message = result.Message;
    }

    protected override async Task OnInitializedAsync()
    {
        var authState = await _AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        userName = user.FindFirstValue("Email"); // or "UserName"
    }

  
}
