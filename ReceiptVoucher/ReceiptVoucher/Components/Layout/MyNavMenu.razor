@rendermode InteractiveServer

@using ReceiptVoucher.Client.Services
@using ReceiptVoucher.Core.Consts
@using ReceiptVoucher.Core.Models.ViewModels.UserModels
@inject AuthenticationStateProvider _AuthenticationStateProvider
@inject ILocalStorageService LocalStorage
@inject NavigationManager NavigationManager
@inject IAuthService _IAuthservice



<MudNavMenu Color="Color.Info" Bordered="true">

    <MudImage Src="images\logo.svg" Style="margin-top:-2%;margin-right:10px" Width="200" Height="100" Alt="Icon" />

    <hr style="color: var(--color-custom); ;margin-top:0%" />

    @if (UserRole.Equals(RolesNames.Admin))
    {

        <MudNavLink Href="home" Match="NavLinkMatch.All" Class="mud-nav-link-right navLinkBtn">
            <MudIcon Icon="@Icons.Material.Filled.Home" Class="icon-color" />
            الصفحة الرئيسية
        </MudNavLink>
        <MudNavLink Href="/Branches" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right navLinkBtn">
            <MudIcon Icon="@Icons.Material.Filled.Apartment" Class="icon-color" />
            المراكز الاعلامية
        </MudNavLink>
        <MudNavLink Href="/Project" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right navLinkBtn">
            <MudIcon Icon="@Icons.Material.Filled.FileCopy" Class="icon-color" />
            المشاريع الرئيسية
        </MudNavLink>
        <MudNavLink Href="/SubProject" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right navLinkBtn">
            <MudIcon Icon="@Icons.Material.Filled.InsertDriveFile" Class="icon-color" />
            المشاريع الفرعية
        </MudNavLink>
        <MudNavLink Href="/Receipt" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right navLinkBtn">
            <MudIcon Icon="@Icons.Material.Filled.ChromeReaderMode" Class="icon-color" />
            السندات
        </MudNavLink>
        <MudNavLink Href="/MinReports" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right navLinkBtn">
            <MudIcon Icon="@Icons.Material.Filled.Assessment" Class="icon-color" />
            التقارير
        </MudNavLink>

        <MudNavLink Href="/Accounts" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right navLinkBtn">
            <MudIcon Icon="@Icons.Material.Filled.SupervisorAccount" Class="icon-color" />
            الحسابات
        </MudNavLink>

    }
    else if (UserRole.Equals(RolesNames.User))
    {
        <MudNavLink Href="/Receipt" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right navLinkBtn">
            <MudIcon Icon="@Icons.Material.Filled.ChromeReaderMode" Class="icon-color" />
            السندات
        </MudNavLink>
        <MudNavLink Href="/MinReports" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right navLinkBtn">
            <MudIcon Icon="@Icons.Material.Filled.Assessment" Class="icon-color" />
            التقارير
        </MudNavLink>
    }

   @*  <AuthorizeView>
        <NotAuthorized>
            <MudNavLink Href="/login" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right logOutBtn">
                <MudIcon Icon="@Icons.Material.Filled.Output" Class="icon-color" />
                تسجيل الدخول
            </MudNavLink>
        </NotAuthorized>
    </AuthorizeView> *@


    
   

    <hr style="color: var(--color-custom); ;margin-top:4%" />
    <MudNavLink Href="/UserProfile" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right navLinkBtn">
        <img src="Images\avatar.webp" alt="Avatar" style="width:14px;"/>
        @currentUser.FirstName @currentUser.LastName
    </MudNavLink>
    <MudNavLink OnClick="Logout"  Match="NavLinkMatch.Prefix" Class="mud-nav-link-right logOutBtn">
        <MudIcon Icon="@Icons.Material.Filled.Output" Class="icon-color" />
        تسجيل خروج
    </MudNavLink>

@*     <MudNavLink   Class="mud-nav-link-right">

        <ReceiptVoucher.Client.Pages.AuthenticationPages.AuthenticationButton />
        
    </MudNavLink> *@



   @*  <MudNavLink Href="/CompanyInfo" Match="NavLinkMatch.Prefix" Class="mud-nav-link-right">
        <MudIcon Icon="@Icons.Material.Outlined.Info" Class="icon-color" />
        معلومات الشركة
    </MudNavLink> *@

</MudNavMenu>

<style>
    .custom-nav-menu {
        padding: 2px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .mud-nav-link-right {
        direction: rtl;
        padding: 8px 16px;
        margin: 3px 0;
        font-size: 1rem;
        color: #52595D; 
    }

    .icon-color {
        color: #566D7E;
    }

    .logOutBtn .mud-nav-link:hover svg {
        color: white !important;
    }

    .logOutBtn .mud-nav-link {
        border: 2px solid var(--bs-danger) !important;
        color: var(--bs-danger) !important;
        /*font-size: 17px;*/
        font-weight: bold;
    }

        .logOutBtn .mud-nav-link svg {
            color: var(--bs-danger) !important;
        }

        .logOutBtn .mud-nav-link:hover {
            background-color: var(--bs-danger) !important;
            background-color: #dc3545 !important;
            color: white !important;
            /* font-size: 17px; */
            font-weight: bold;
        }
    /*------*/

</style>






    <!--اكواد ربما احتاج لها-->
   @*  <MudNavGroup Title="Settings" Expanded="true">
        <MudNavLink Href="/users" Match="NavLinkMatch.Prefix">Users</MudNavLink>
        <MudNavLink Href="/security" Match="NavLinkMatch.Prefix">Security</MudNavLink>
    </MudNavGroup>
    <MudNavLink Href="/about" Match="NavLinkMatch.Prefix">About</MudNavLink>
</MudNavMenu>
 *@

@code{
    public string UserRole  = string.Empty;
    public UserViewModel currentUser { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        var authState = await _AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState?.User;

        if (user != null)
        {
            var roleClaim = user.FindFirst("roles");
            if (roleClaim != null)
            {
                UserRole = roleClaim.Value;
            }
        }

        currentUser = await _IAuthservice.GetCurrentUserDetailsAsync();

        
    }

    private async Task Logout()
    {
        await LocalStorage.RemoveItemAsync("authToken");
        await _AuthenticationStateProvider.GetAuthenticationStateAsync();
        NavigationManager.NavigateTo("/Login");
    }
}